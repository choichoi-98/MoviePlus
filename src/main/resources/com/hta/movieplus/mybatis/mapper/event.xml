<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hta.movieplus.mybatis.mapper.EventMapper">

	<insert id="insert_event" parameterType="event">
		INSERT INTO EVENT
		VALUES((<include refid="insert_EVENT_NUM" />), #{EVENT_TYPE}, 
		#{EVENT_SUBJECT}, #{EVENT_CONTENT}, SYSDATE, #{EVENT_FILE}, 
		#{EVENT_STARTDATE}, #{EVENT_ENDDATE},#{EVENT_STATUS})
	</insert>	
	
		<sql id="insert_EVENT_NUM">
			select nvl(max(EVENT_NUM),0)+1 from EVENT
		</sql>
	
	<select id="getAllEventList" resultType="event">	<!-- 이벤트 전체 총 목록 -->
		SELECT * 
		FROM EVENT
	</select>
	
	<select id="getMovieEventList" resultType="event">	<!-- 영화 이벤트 목록 -->
		SELECT * 
		FROM EVENT
		WHERE EVENT_TYPE = 'MOVIE'
	</select>
	
	<select id="getMovieEventListCount" resultType="int">	<!-- 영화 이벤트 목록 COUNT -->
		SELECT COUNT(*) 
		FROM EVENT
		WHERE EVENT_TYPE = 'MOVIE'
	</select>
	
	<select id="getTheaterEventList" resultType="event">	<!-- 극장 이벤트 목록 -->
		SELECT * 
		FROM EVENT
		WHERE EVENT_TYPE = 'THEATER'
	</select>
	
	<select id="getTheaterEventListCount" resultType="int">	<!-- 극장 이벤트 목록 COUNT-->
		SELECT COUNT(*)
		FROM EVENT
		WHERE EVENT_TYPE = 'THEATER'
	</select>
	
	<select id="getPromotionEventList" resultType="event"> 	<!-- 제휴/할인 이벤트 목록 -->
		SELECT * 
		FROM EVENT
		WHERE EVENT_TYPE = 'PROMOTION'
	</select>
	
	<select id="getPromotionEventListCount" resultType="int"> 	<!-- 제휴/할인 이벤트 목록 Count -->
		SELECT COUNT(*) 
		FROM EVENT
		WHERE EVENT_TYPE = 'PROMOTION'
	</select>
	
	<select id="getCurtaincallEventList" resultType="event">	<!-- 시사회 이벤트 목록 -->
		SELECT * 
		FROM EVENT
		WHERE EVENT_TYPE = 'CURTAINCALL'
	</select>
	
	<select id="getCurtaincallEventListCount" resultType="int">	<!-- 시사회 이벤트 목록 Count -->
		SELECT COUNT(*) 
		FROM EVENT
		WHERE EVENT_TYPE = 'CURTAINCALL'
	</select>
	
	<select id="getEventListCount" resultType="int">	<!-- 이벤트 전체 개수 -->
		select count(*) 
		from EVENT
	</select>
	
	
	<select id="getEventList" parameterType="java.util.Map" resultType="event">
		SELECT * 
		FROM (
			   SELECT ROWNUM AS RNUM, EVENT.*
			    FROM EVENT
			  )
	</select>
	
	<select id="getDetailEvent" parameterType="int" resultType="event">		<!-- 이벤트 상세페이지 -->
		SELECT *
		FROM EVENT
		WHERE EVENT_NUM = #{EVENT_NUM}
	</select>

	<delete id="deleteEvent" parameterType="int">
		DELETE
		FROM EVENT
		WHERE EVENT_NUM = #{EVENT_NUM}
	</delete>
	
	<update id="updateEvent" parameterType="event">
		update EVENT
		set EVENT_TYPE = #{EVENT_TYPE},
			EVENT_SUBJECT = #{EVENT_SUBJECT}, 
			EVENT_CONTENT = #{EVENT_CONTENT}, 
			EVENT_FILE = #{EVENT_FILE}, 
			EVENT_STARTDATE = #{EVENT_STARTDATE}, 
			EVENT_ENDDATE = #{EVENT_ENDDATE}
		WHERE EVENT_NUM = #{EVENT_NUM}
	</update>

	<update id="changeStatus" parameterType="map">
		update EVENT
		<choose>	
			<when test='EVENT_STATUS == "END"'>
				set EVENT_STATUS = 'PROGRESS'
			</when>
			<when test='EVENT_STATUS == "PROGRESS"'>
				set EVENT_STATUS = 'END'
			</when>
		</choose>
		WHERE EVENT_NUM = #{EVENT_NUM}	
	</update>
	
	
	
</mapper>
